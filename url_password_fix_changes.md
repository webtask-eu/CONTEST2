# Удаление WebAPI и исправление паролей

## 1. Исправление проблемы с паролями

### Проблема
При сохранении пароля, содержащего символ `<` (например, `nX76<hv3sMRk`), система сохраняла его в базе данных как `nX76&lt;hv3sMRk` из-за использования `sanitize_text_field()`.

При отправке такого пароля на API сервер через URL, символ `&` в `&lt;` интерпретировался как разделитель параметров, что приводило к обрезанию пароля до `nX76`.

### Решение
Добавлено декодирование HTML-сущностей в пароле перед отправкой на API сервер в функции `process_trading_account()`.

## 2. Удаление WebAPI функционала

### Причина
Система больше не использует WebAPI (128.140.100.35) и работает только с прямыми подключениями к серверу.

### Изменения

#### Удалено из конфигурации API:
- Опция выбора режима API (proxy/direct)
- Ссылки на WebAPI 128.140.100.35
- Функции для переключения режимов

#### Оставлено только:
- Прямое подключение к серверу API
- Настройки IP-адреса и порта сервера
- Проверка соединения

## 3. Измененные файлы

### Contest Plugin (Конкурсы):
1. **`contest_plugin/contests/includes/class-api-config.php`**
   - Удалена логика выбора режима API
   - Оставлена только функция для прямого подключения

2. **`contest_plugin/contests/admin/class-settings-page.php`**
   - Удалена регистрация поля `ft_api_mode`
   - Удалена функция `render_api_mode_field()`
   - Упрощены функции для IP и порта

3. **`contest_plugin/contests/includes/class-api-handler.php`**
   - Добавлено декодирование HTML-сущностей в пароле

### Monitoring Plugin (Мониторинг):
1. **`monitoring_plugin/includes/class-api-config.php`**
   - Удалена логика выбора режима API
   - Оставлена только функция для прямого подключения

2. **`monitoring_plugin/admin/class-settings-page.php`**
   - Удалена регистрация поля `ft_api_mode`
   - Удалена функция `render_api_mode_field()`
   - Упрощены функции для IP и порта

3. **`monitoring_plugin/includes/class-api-handler.php`**
   - Добавлено декодирование HTML-сущностей в пароле

## 4. Изменения в коде

### Декодирование HTML-сущностей в пароле:
```php
// ИСПРАВЛЕНИЕ: Декодируем HTML-сущности в пароле перед отправкой
$decoded_password = html_entity_decode($password, ENT_QUOTES, 'UTF-8');
if ($decoded_password !== $password) {
    error_log("Пароль содержал HTML-сущности: '$password' -> '$decoded_password'");
    $params['password'] = $decoded_password;
}
```

### Упрощение API конфигурации:
```php
// Только прямое подключение
public static function get_api_url() {
    $server_ip = get_option('ft_server_api_ip', 'localhost');
    $server_port = get_option('ft_server_api_port', '80');
    return "http://{$server_ip}:{$server_port}/api_json_wp.php";
}
```

## 5. Конфигурация после изменений

### Настройки API сервера:
- **IP-адрес**: 127.0.0.1 (по умолчанию)
- **Порт**: 80 (по умолчанию)
- **Проверка соединения**: Доступна через админ-панель

### Удаленные настройки:
- Выбор режима API (proxy/direct)
- Ссылки на WebAPI 128.140.100.35
- Переключатели между режимами

## 6. Результат

✅ **Полностью решены проблемы:**
- Исправлена обработка паролей со специальными символами
- Удален весь функционал WebAPI
- Система использует только прямые подключения к серверу
- Упрощена конфигурация API

✅ **Преимущества:**
- Простота конфигурации
- Нет зависимости от внешних WebAPI
- Все пароли передаются корректно
- Единый способ подключения к серверу 