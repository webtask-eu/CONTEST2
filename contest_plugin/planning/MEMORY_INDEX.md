# Индекс памяти плагина конкурсов трейдеров

## Основные файлы и директории

### Ключевые файлы плагина
- `contests/ft-trader-contest.php` - Основной файл плагина с настройками и инициализацией
- `contests/includes/class-account-updater.php` - Класс для управления обновлением счетов
- `contests/includes/class-api-handler.php` - Обработчик API-запросов и AJAX-запросов
- `contests/includes/class-disqualification-checker.php` - Проверка дисквалификации счетов
- `contests/admin/class-accounts-list-table.php` - Таблица счетов в админ-панели
- `contests/admin/class-admin-pages.php` - Страницы администрирования
- `contests/admin/class-settings-page.php` - Страница настроек плагина
- `contests/admin/js/admin.js` - JavaScript для админ-интерфейса

### Шаблоны отображения
- `contests/templates/single-contest.php` - Шаблон отображения страницы конкурса
- `contests/templates/single-account.php` - Шаблон отображения страницы счета

### Планирование и документация
- `planning/BUG_FIXES_LOG.md` - Журнал исправления ошибок
- `planning/MEMORY_INDEX.md` - Этот файл, индекс памяти проекта

## Особенности реализации

### Обновление счетов
Обновление счетов происходит через класс `Account_Updater`. Ключевые методы:
- `init_queue()` - Инициализирует очередь на обновление
- `process_batch()` - Обрабатывает порцию счетов
- `get_status()` - Возвращает статус обновления
- `run_auto_update()` - Запускает автоматическое обновление

После изменений система поддерживает параллельное обновление счетов разных конкурсов.

### Мониторинг очередей обновления
Для отображения и мониторинга активных очередей реализованы следующие компоненты:
- `get_active_update_queues_html()` - Функция для генерации HTML с данными об активных очередях
- AJAX обработчик `ajax_get_active_update_queues()` - Получение актуальной информации без перезагрузки
- Автоматическое обновление через JavaScript - с разными интервалами в зависимости от наличия активных очередей
- Визуализация прогресса обновления с помощью прогресс-баров

Система мониторинга позволяет отслеживать:
- Общее количество счетов в каждой очереди
- Количество обработанных счетов
- Количество успешных и неудачных обновлений
- Время начала процесса обновления
- Текущий статус очереди (выполняется/завершено/остановлено)

### API/AJAX обработчики
В `class-api-handler.php` реализованы основные обработчики:
- `fttradingapi_create_update_queue` - Создание очереди обновления
- `fttradingapi_get_update_status` - Получение статуса обновления
- `process_trading_account` - Обработка данных торгового счета

### Интерфейс администратора
- Таблица счетов (`class-accounts-list-table.php`) расширяет стандартный класс WordPress `WP_List_Table`
- JavaScript (`admin.js`) обеспечивает интерактивное взаимодействие, включая обновление счетов

### Система обновления данных
- Реализована система параллельных очередей обновления счетов для разных конкурсов
- Поддерживается автоматическое обновление счетов по расписанию через WP Cron
- Реализован механизм очистки зависших очередей обновления для восстановления работы системы
- Система обрабатывает счета порциями для снижения нагрузки на сервер и API
- Поддерживается приоритетное обновление новых счетов для быстрого отображения данных

## Структура базы данных
Основные таблицы:
- `{prefix}contest_members` - Информация о счетах участников
- `{prefix}contest_members_orders` - Текущие открытые позиции
- `{prefix}contest_members_order_history` - История сделок
- `{prefix}contest_members_history` - История изменений параметров счетов

## Последние изменения
- Добавлен механизм восстановления расписания автоматического обновления счетов
- Добавлен функционал очистки зависших очередей обновления счетов через интерфейс настроек
- Исправлена проблема с зависшими очередями обновления счетов, добавлен прямой запуск обработки
- Добавлен интерфейс мониторинга активных очередей обновления на странице всех счетов
- Реализована система отображения информации о прогрессе обновления счетов
- Добавлено автоматическое обновление информации об очередях через AJAX
- Реализовано параллельное обновление счетов разных конкурсов
- Добавлена возможность определения ID конкурса из URL или данных счета
- Обновлены API-обработчики для поддержки параллельного обновления 