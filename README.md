# Документация проекта "CONTEST2"

## Описание

"CONTEST2" — комплексная система для проведения конкурсов трейдеров на платформе MetaTrader 4 с интеграцией через WordPress-плагин, серверный API и веб-интерфейс.

Проект состоит из нескольких компонентов:
- **MT4CONTESTSCRIPT** — скрипты и исходники для MetaTrader 4 (MQL4), отвечающие за экспорт данных и интеграцию с сервером.
- **PLUGIN** — WordPress-плагин для управления конкурсами, отображения рейтингов и взаимодействия с пользователями.
- **SERVERAPI** — серверная часть на Python (Flask API) для обработки данных, поступающих от MetaTrader и взаимодействия с WordPress.
- **WEBAPI** — веб-интерфейс на PHP/HTML для отображения информации и взаимодействия с пользователями.

---

## Структура репозитория

```
CONTEST2/
├── MT4CONTESTSCRIPT/         # Скрипты и исходники для MetaTrader 4 (MQL4)
├── PLUGIN/                   # WordPress-плагин для конкурсов трейдеров
│   └── contests/             # Основная логика плагина
├── SERVERAPI/                # Серверное API на Python (Flask)
│   └── app/                  # Основное приложение Flask
├── WEBAPI/                   # Веб-интерфейс на PHP/HTML
├── dump_code.sh              # Скрипты для дампа кода
├── dump_frontend_code.sh
├── dump_structure.sh
├── project_structure_dump_1.txt # Сводная структура и описание файлов
└── ...
```

---

## Компоненты

### 1. MT4CONTESTSCRIPT
- Скрипты на MQL4 для экспорта информации о счетах и истории сделок.
- Используются для интеграции MetaTrader с серверной частью через API.

### 2. PLUGIN
- WordPress-плагин для управления конкурсами трейдеров.
- Включает:
  - регистрацию/авторизацию участников,
  - отображение рейтингов,
  - обработку AJAX-запросов,
  - шаблоны страниц и форм.
- Основные директории:
  - `admin/` — административный интерфейс
  - `frontend/` — публичная часть
  - `includes/` — бизнес-логика и обработчики
  - `templates/` — шаблоны страниц

### 3. SERVERAPI
- Серверное приложение на Python (Flask).
- Обрабатывает запросы от MT4-скриптов и WordPress-плагина.
- Реализует API для приема/отправки данных, логирования, управления процессами.
- Основные файлы:
  - `app/routes.py` — маршруты API
  - `app/__init__.py` — инициализация приложения
  - `app/config.py` — конфигурация
  - `wsgi.py` — точка входа для WSGI-сервера

### 4. WEBAPI
- Набор PHP-скриптов, выполняющих функции прокси и форматтера между сервером на Python (SERVERAPI) и внешними клиентами (WordPress-плагин, фронтенд, MT4-скрипты, старые клиенты).
- Реализует API-эндпоинты (`api.php`, `api_json.php`, `api_json_wp.php`, `api_old.php`), которые принимают HTTP-запросы, перенаправляют их на Python-сервер через curl, получают ответ, форматируют его (текст, JSON, JSON для WP) и возвращают клиенту.
- Не хранит данные локально, не взаимодействует напрямую с базой данных или MetaTrader, а только маршрутизирует и форматирует ответы.
- Используется для интеграции с WordPress, фронтендом, а также для обратной совместимости со старыми клиентами.

---

## Взаимодействие компонентов

### Схема обмена данными

1. **MT4CONTESTSCRIPT (MetaTrader 4)**
    - Скрипты на MQL4 экспортируют данные о счетах и сделках и отправляют их через HTTP-запросы на Python-сервер (**SERVERAPI**).

2. **SERVERAPI (Python Flask)**
    - Получает данные от MT4-скриптов, обрабатывает их, сохраняет и предоставляет API для получения и передачи данных другим модулям.
    - Не взаимодействует напрямую с клиентами WordPress или фронтендом, а только через WEBAPI.

3. **WEBAPI (PHP-прокси)**
    - Получает HTTP-запросы от WordPress-плагина, фронтенда, старых клиентов или других внешних систем.
    - Использует curl для перенаправления запросов на SERVERAPI, получает ответ, форматирует его (текст, JSON, JSON для WP) и возвращает клиенту.
    - Не хранит данные и не взаимодействует напрямую с MetaTrader или базой данных.

4. **PLUGIN (WordPress)**
    - Выполняет AJAX-запросы к WEBAPI (обычно к `api_json_wp.php`) для получения информации о конкурсах, счетах, истории сделок и т.д.
    - Отображает данные пользователям, позволяет регистрироваться, просматривать рейтинги и историю.
    - Может инициировать обновление данных через WEBAPI.

#### Визуальная схема и двустороннее взаимодействие:

В системе реализован двусторонний обмен данными. Не только MT4 отправляет данные вверх, но и WordPress-плагин или другие клиенты могут инициировать действия (например, запросить обновление, открыть/закрыть сделку, получить свежие данные), которые проходят через все слои до MT4 и возвращают результат обратно.

```
  ┌───────────────────────────────────────────────────────────────┐
  │                        ▼  (1. Данные, события, команды)      │
  │  MT4CONTESTSCRIPT   ⇄   SERVERAPI   ⇄   WEBAPI   ⇄   PLUGIN  │
  │    (MT4)            ⇄   (Python)    ⇄   (PHP)    ⇄ (WordPress│
  │                        ▲  (2. Ответ, результат, обновления)   │
  └───────────────────────────────────────────────────────────────┘

      ▲                                               ▲
      │                                               │
      │        Внешние клиенты (фронтенд, старые       │
      │        интеграции) могут обращаться к WEBAPI   │
      │        напрямую и получать/отправлять данные  │
      ▼                                               ▼
```

**Пояснения к схеме:**
- (1) — Плагин WordPress или внешний клиент инициирует запрос (например, обновить счет, получить историю, открыть сделку).
- Запрос проходит через WEBAPI (PHP), затем через SERVERAPI (Python) и доходит до MT4CONTESTSCRIPT (MQL4/MetaTrader 4).
- (2) — Результат или ответ возвращается тем же путем обратно: от MT4 к SERVERAPI, затем к WEBAPI и далее к плагину или клиенту.
- Таким образом, поддерживается полноценный двусторонний обмен: не только сбор данных с MT4, но и управление/команды из WordPress/клиентов.

---

## Установка и запуск

### Требования
- Python 3.8+
- Flask
- WordPress (для плагина)
- MetaTrader 4 (для скриптов)
- PHP 7+

### 1. Установка SERVERAPI
```
cd SERVERAPI
pip install -r requirements.txt  # если есть requirements.txt
python wsgi.py
```

### 2. Установка PLUGIN
- Скопируйте папку `PLUGIN/contests` в директорию плагинов WordPress (`wp-content/plugins/`).
- Активируйте плагин через админку WordPress.

### 3. Установка MT4CONTESTSCRIPT
- Скомпилируйте `.mq4` файлы в MetaEditor и установите их в папку `Experts`/`Scripts` вашего терминала MT4.

### 4. Установка WEBAPI
- Разместите содержимое папки `WEBAPI` на вашем PHP-сервере.

---

## Авторы и лицензия
- Автор: [Указать имя/команду]
- Лицензия: [Указать тип лицензии]

---

## TODO / Дальнейшее развитие
- [ ] Добавить подробную документацию по каждому API-методу
- [ ] Описать структуру базы данных
- [ ] Примеры запросов и ответов
- [ ] Скриншоты интерфейса

---

Для вопросов и поддержки — обращайтесь к автору проекта.
